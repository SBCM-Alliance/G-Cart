<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G-Cart | ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ»ã‚¼ãƒã‚³ãƒ³</title>
    
    <!-- PyScript (Lightweight) -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- STREAMLIT-LIKE THEME --- */
        :root {
            --bg: #ffffff;
            --text: #31333F;
            --card-bg: #ffffff;
            --primary: #FF4B4B; /* Streamlit Red */
            --secondary: #F0F2F6;
            --accent: #00CC96;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: "Source Sans Pro", sans-serif; padding: 20px;
            max-width: 1000px; margin: 0 auto;
        }

        /* HEADER */
        header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 1.8rem; }
        .user-badge { background: var(--secondary); padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }

        /* UTIL */
        .hidden { display: none !important; }
        .tag { background: #e8e8e8; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px; }

        /* CARDS (Amazon Style) */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card {
            background: var(--card-bg); border: 1px solid #ddd; border-radius: 8px; padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .card:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
        
        .p-icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .p-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; }
        .p-loc { color: #666; font-size: 0.9rem; margin-bottom: 10px; }
        .p-budget { font-size: 1.5rem; font-weight: bold; color: #333; margin: 10px 0; }
        
        .alert-box {
            background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px;
            font-size: 0.9rem; margin: 10px 0; display: flex; align-items: center;
        }
        .success-box {
            background: #d4edda; color: #155724; padding: 10px; border-radius: 4px;
            font-size: 0.9rem; margin: 10px 0;
        }

        /* BUTTONS */
        .btn {
            width: 100%; padding: 10px; border: none; border-radius: 4px; cursor: pointer;
            font-weight: bold; margin-top: 10px; transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #ff2b2b; }
        .btn-sec { background: var(--secondary); color: #333; }
        .btn-sec:hover { background: #e0e2e6; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* PHASE 2: MATCHING (Tinder Style) */
        .matching-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        @media (max-width: 768px) { .matching-layout { grid-template-columns: 1fr; } }

        .progress-container { background: #eee; border-radius: 10px; height: 20px; width: 100%; margin: 10px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.5s; }
        .progress-bar.complete { background: var(--accent); }

        .partner-card {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #eee; padding: 15px 0;
        }
        .p-cap { color: #666; font-size: 0.9rem; }

        /* PHASE 3: EXECUTION */
        .wallet-row { display: flex; gap: 20px; margin-bottom: 30px; }
        .metric-box { flex: 1; background: #fafafa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
        .metric-val { font-size: 1.5rem; font-weight: bold; display: block; }
        .metric-label { color: #666; font-size: 0.8rem; }

        /* Fake Gantt */
        .gantt-chart { margin-top: 20px; }
        .g-row { display: flex; margin-bottom: 10px; align-items: center; }
        .g-label { width: 100px; font-size: 0.8rem; font-weight: bold; }
        .g-bar-container { flex: 1; background: #eee; height: 20px; border-radius: 4px; position: relative; }
        .g-bar { position: absolute; height: 100%; border-radius: 4px; opacity: 0.8; }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center;">
            <span style="font-size:2rem; margin-right:10px;">ğŸ›’</span>
            <div>
                <h1 style="line-height:1;">G-Cart</h1>
                <small style="color:#666;">Government Cart System</small>
            </div>
        </div>
        <div class="user-badge">
            ğŸ‘¤ å‡ºæœ¨æ‰åœŸæœ¨ (ä½™åŠ›: Â¥3,000ä¸‡)
        </div>
    </header>

    <!-- PHASE 1: SELECTION -->
    <div id="p1-selection">
        <h2 style="border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ“¦ ãŠã™ã™ã‚ã®å…¬å…±äº‹æ¥­</h2>
        <div id="project-grid" class="grid">
            <!-- Python injects cards here -->
        </div>
    </div>

    <!-- PHASE 2: MATCHING -->
    <div id="p2-matching" class="hidden">
        <button class="btn btn-sec" style="width:auto; margin-bottom:20px;" py-click="back_to_list">â† ä¸€è¦§ã«æˆ»ã‚‹</button>
        
        <div class="matching-layout">
            <!-- Left: Project Status -->
            <div class="card">
                <span id="m-icon" style="font-size:3rem;">ğŸ—ï¸</span>
                <h2 id="m-title">Project Name</h2>
                <p id="m-budget" class="p-budget">Â¥0</p>
                <div class="progress-container">
                    <div id="jv-bar" class="progress-bar"></div>
                </div>
                <p style="font-size:0.9rem;">
                    ç¾åœ¨ã®ã‚­ãƒ£ãƒ‘: <b id="curr-cap">Â¥3,000ä¸‡</b> / å¿…è¦: <span id="req-cap">Â¥0</span>
                </p>
                
                <div id="jv-members" style="margin-top:20px; background:#f9f9f9; padding:10px; border-radius:4px;">
                    <div style="font-weight:bold; margin-bottom:5px;">çµæˆãƒ¡ãƒ³ãƒãƒ¼ (JV)</div>
                    <div>ğŸ‘¤ å‡ºæœ¨æ‰åœŸæœ¨ (Leader)</div>
                    <div id="member-list"></div>
                </div>

                <div id="msg-area"></div>
                <button id="btn-final" class="btn btn-sec" disabled py-click="go_execution">JVçµæˆå®Œäº†ãƒ»å…¥æœ­</button>
            </div>

            <!-- Right: Recommendations -->
            <div>
                <h3>ğŸ” AI ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰</h3>
                <p style="font-size:0.8rem; color:#666;">ä¸è¶³ã—ã¦ã„ã‚‹å·¥ç¨®ãƒ»ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’æŒã¤è¿‘éš£ä¼æ¥­</p>
                <div id="partner-list"></div>
            </div>
        </div>
    </div>

    <!-- PHASE 3: EXECUTION -->
    <div id="p3-execution" class="hidden">
        <h2>ğŸ“… G-Gantt (æ–½å·¥ç®¡ç†)</h2>
        <div class="alert-box" style="background:#d4edda; color:#155724;">
            <i class="fas fa-check-circle" style="margin-right:5px;"></i> å…¥æœ­ãŒç¢ºå®šã—ã€æ–½å·¥ãƒ•ã‚§ãƒ¼ã‚ºã«ç§»è¡Œã—ã¾ã—ãŸã€‚
        </div>

        <div class="wallet-row">
            <div class="metric-box">
                <span class="metric-label">å—æ³¨ç·é¡</span>
                <span id="ex-total" class="metric-val">Â¥0</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">å³æ™‚åˆ†é…æ¸ˆã¿</span>
                <span class="metric-val" style="color:var(--accent);">Â¥15,000,000</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">ãƒ—ãƒ¼ãƒ«æ®‹é«˜</span>
                <span class="metric-val">Â¥35,000,000</span>
            </div>
        </div>

        <div class="card">
            <h3>å·¥ç¨‹è¡¨ (Real-time)</h3>
            <div class="gantt-chart">
                <div class="g-row">
                    <div class="g-label">å‡ºæœ¨æ‰åœŸæœ¨</div>
                    <div class="g-bar-container"><div class="g-bar" style="width:40%; left:0; background:#FF4B4B;">æº–å‚™å·¥ (ä½œæ¥­ä¸­)</div></div>
                </div>
                <div class="g-row">
                    <div class="g-label">ç”°ä¸­èˆ—è£…</div>
                    <div class="g-bar-container"><div class="g-bar" style="width:30%; left:40%; background:#ccc;">èˆ—è£…å·¥ (å¾…æ©Ÿ)</div></div>
                </div>
                <div class="g-row">
                    <div class="g-label">æŸè­¦å‚™</div>
                    <div class="g-bar-container"><div class="g-bar" style="width:20%; left:70%; background:#ccc;">äº¤é€šèª˜å° (å¾…æ©Ÿ)</div></div>
                </div>
            </div>
            
            <div style="margin-top:30px; text-align:right;">
                <button class="btn btn-primary" style="width:auto;" onclick="location.reload()">ãƒ‡ãƒ¢çµ‚äº† (Reset)</button>
            </div>
        </div>
    </div>

    <!-- PYTHON LOGIC -->
    <script type="py">
        from pyscript import document
        from pyodide.ffi import create_proxy
        import js

        # --- DATA ---
        my_cap = 30000000
        current_cap = my_cap
        target_budget = 0
        
        projects = [
            {"id":1, "name": "å¸‚é“123å·ç·š èˆ—è£…æ”¹ä¿®å·¥äº‹", "loc": "æŸå¸‚ãƒ»åŒ—ã‚¨ãƒªã‚¢", "budget": 50000000, "icon": "ğŸš§", "tags": ["èˆ—è£…", "è­¦å‚™"]},
            {"id":2, "name": "æŸã®è‘‰å…¬åœ’ å…¬è¡†ãƒˆã‚¤ãƒ¬æ–°è¨­", "loc": "æŸå¸‚ãƒ»è¥¿ã‚¨ãƒªã‚¢", "budget": 80000000, "icon": "ğŸš½", "tags": ["å»ºç¯‰", "æ°´é“"]},
            {"id":3, "name": "å°å­¦æ ¡ é€šå­¦è·¯ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«", "loc": "æŸå¸‚ãƒ»ä¸­å¤®", "budget": 15000000, "icon": "ğŸ›¡ï¸", "tags": ["åœŸæœ¨"]},
        ]
        
        partners = [
            {"name": "ç”°ä¸­èˆ—è£…ãƒ­ãƒ¼ãƒ‰", "type": "èˆ—è£…", "cap": 30000000},
            {"name": "æŸè­¦å‚™ä¿éšœ", "type": "è­¦å‚™", "cap": 5000000},
            {"name": "æ¾æˆ¸é›»æ°—ã‚µãƒ¼ãƒ“ã‚¹", "type": "é›»æ°—", "cap": 20000000},
            {"name": "æµå±±æ°´é“ãƒ¡ãƒ³ãƒ†", "type": "æ°´é“", "cap": 15000000},
        ]

        # --- LOGIC ---
        def init():
            grid = document.getElementById("project-grid")
            grid.innerHTML = ""
            
            for p in projects:
                div = document.createElement("div")
                div.className = "card"
                
                shortage = p["budget"] - my_cap
                if shortage > 0:
                    status = f'<div class="alert-box"><i class="fas fa-exclamation-triangle"></i>&nbsp;å˜ç‹¬ä¸å¯ (ä¸è¶³ Â¥{shortage:,})</div>'
                    btn_cls = "btn-primary"
                    btn_txt = "ğŸ¤ ãƒãƒ¼ãƒ çµæˆ (JV)"
                else:
                    status = '<div class="success-box"><i class="fas fa-check"></i>&nbsp;å˜ç‹¬å—æ³¨å¯èƒ½</div>'
                    btn_cls = "btn-sec"
                    btn_txt = "ğŸš€ å…¥æœ­ã¸é€²ã‚€"
                
                tags = "".join([f"<span class='tag'>{t}</span>" for t in p["tags"]])
                
                div.innerHTML = f"""
                    <span class="p-icon">{p['icon']}</span>
                    <div class="p-title">{p['name']}</div>
                    <div class="p-loc">ğŸ“ {p['loc']}</div>
                    <div class="p-budget">Â¥{p['budget']:,}</div>
                    <div style="margin-bottom:10px;">{tags}</div>
                    {status}
                """
                
                btn = document.createElement("button")
                btn.className = f"btn {btn_cls}"
                btn.innerText = btn_txt
                btn.onclick = lambda e, pr=p: go_matching(pr)
                
                div.appendChild(btn)
                grid.appendChild(div)

        def go_matching(p):
            global target_budget, current_cap
            target_budget = p["budget"]
            current_cap = my_cap
            
            # Switch Screen
            document.getElementById("p1-selection").classList.add("hidden")
            document.getElementById("p2-matching").classList.remove("hidden")
            
            # Setup Left Col
            document.getElementById("m-icon").innerText = p["icon"]
            document.getElementById("m-title").innerText = p["name"]
            document.getElementById("m-budget").innerText = f"Â¥{p['budget']:,}"
            document.getElementById("req-cap").innerText = f"Â¥{p['budget']:,}"
            document.getElementById("member-list").innerHTML = "" # Clear members
            
            # Setup Right Col (Partners)
            plist = document.getElementById("partner-list")
            plist.innerHTML = ""
            
            for ptr in partners:
                # Simple recommendation logic (tag match or capacity)
                is_match = ptr["type"] in p["tags"]
                match_badge = "âœ¨ æ¨å¥¨" if is_match else ""
                
                row = document.createElement("div")
                row.className = "card partner-card"
                row.style.marginBottom = "10px"
                
                row.innerHTML = f"""
                    <div>
                        <div style="font-weight:bold;">{ptr['name']} <span style="color:#FF4B4B;font-size:0.8rem;">{match_badge}</span></div>
                        <div class="p-cap">ğŸ”§ {ptr['type']} | ä½™åŠ›: Â¥{ptr['cap']//10000}ä¸‡</div>
                    </div>
                """
                btn = document.createElement("button")
                btn.className = "btn btn-sec"
                btn.style.width = "auto"
                btn.style.marginTop = "0"
                btn.innerText = "ï¼‹ è¿½åŠ "
                btn.onclick = lambda e, c=ptr['cap'], n=ptr['name'], b=btn: add_partner(c, n, b)
                
                row.appendChild(btn)
                plist.appendChild(row)
            
            update_bar()

        def add_partner(cap, name, btn):
            global current_cap
            current_cap += cap
            
            # Disable button
            btn.innerText = "è¿½åŠ æ¸ˆ"
            btn.disabled = True
            
            # Add to list
            mlist = document.getElementById("member-list")
            div = document.createElement("div")
            div.innerText = f"ğŸ¤ {name}"
            mlist.appendChild(div)
            
            update_bar()

        def update_bar():
            pct = min(100, int((current_cap / target_budget) * 100))
            bar = document.getElementById("jv-bar")
            bar.style.width = f"{pct}%"
            
            document.getElementById("curr-cap").innerText = f"Â¥{current_cap:,}"
            
            btn = document.getElementById("btn-final")
            msg = document.getElementById("msg-area")
            
            if pct >= 100:
                bar.classList.add("complete")
                btn.disabled = False
                btn.className = "btn btn-primary"
                msg.innerHTML = '<div class="success-box">ğŸ‰ ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£è¦ä»¶ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼</div>'
            else:
                bar.classList.remove("complete")
                btn.disabled = True
                btn.className = "btn btn-sec"
                short = target_budget - current_cap
                msg.innerHTML = f'<div class="alert-box">ã‚ã¨ Â¥{short:,} è¶³ã‚Šã¾ã›ã‚“</div>'

        def go_execution(e):
            document.getElementById("p2-matching").classList.add("hidden")
            document.getElementById("p3-execution").classList.remove("hidden")
            document.getElementById("ex-total").innerText = f"Â¥{target_budget:,}"

        def back_to_list(e):
            document.getElementById("p2-matching").classList.add("hidden")
            document.getElementById("p1-selection").classList.remove("hidden")

        init()
    </script>
  </body>
</html>
